<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map Scaling Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .map-container {
      position: relative;
      width: 100%;
      height: calc(100vh - 250px);
      min-height: 500px;
      background-color: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .map-layers-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      transform-origin: top left;
    }
    
    .map-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 1.0;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .map-layer img,
    .map-layer iframe {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .event-markers-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 20;
      pointer-events: none;
    }
    
    .event-marker {
      position: absolute;
      transform: translate(-50%, -50%);
      z-index: 800;
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 0 6px rgba(0,0,0,0.6);
      border-radius: 50%;
      pointer-events: auto;
      transition: transform 0.2s ease;
      background-color: red;
    }
    
    .event-marker:hover {
      transform: translate(-50%, -50%) scale(1.2);
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
      z-index: 850;
    }
    
    .controls {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    button {
      padding: 8px 16px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    
    button:hover {
      background-color: #0069d9;
    }
    
    .test-info {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    @media (max-width: 768px) {
      .map-container {
        height: calc(100vh - 180px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Map Scaling Test</h1>
    
    <div class="map-container" id="mapContainer">
      <div class="map-layers-container" id="mapLayers">
        <div class="map-layer">
          <img src="https://via.placeholder.com/1200x900" alt="Test Map" id="mapImage">
        </div>
      </div>
      
      <div class="event-markers-container" id="eventMarkers">
        <!-- Event markers will be added dynamically -->
      </div>
    </div>
    
    <div class="controls">
      <button id="addMarker">Add Random Marker</button>
      <button id="clearMarkers">Clear Markers</button>
      <button id="testPdf">Test PDF</button>
      <button id="testImage">Test Image</button>
      <button id="resetScale">Reset Scale to 1.0</button>
      <button id="toggleFullWidth">Toggle Full Width</button>
    </div>
    
    <div class="test-info">
      <h3>Test Information</h3>
      <p><strong>Window Size:</strong> <span id="windowSize"></span></p>
      <p><strong>Container Size:</strong> <span id="containerSize"></span></p>
      <p><strong>Scale Factor:</strong> <span id="scaleFactor">1.0</span></p>
      <p><strong>Marker Count:</strong> <span id="markerCount">0</span></p>
      <p><strong>Last Marker Position:</strong> <span id="lastMarkerPosition">None</span></p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mapContainer = document.getElementById('mapContainer');
      const mapLayers = document.getElementById('mapLayers');
      const eventMarkers = document.getElementById('eventMarkers');
      const addMarkerButton = document.getElementById('addMarker');
      const clearMarkersButton = document.getElementById('clearMarkers');
      const testPdfButton = document.getElementById('testPdf');
      const testImageButton = document.getElementById('testImage');
      const resetScaleButton = document.getElementById('resetScale');
      const toggleFullWidthButton = document.getElementById('toggleFullWidth');
      
      const windowSizeEl = document.getElementById('windowSize');
      const containerSizeEl = document.getElementById('containerSize');
      const scaleFactorEl = document.getElementById('scaleFactor');
      const markerCountEl = document.getElementById('markerCount');
      const lastMarkerPositionEl = document.getElementById('lastMarkerPosition');
      
      let scale = 1.0;
      let markers = [];
      let isFullWidth = false;
      
      // Update display sizes
      function updateSizeInfo() {
        windowSizeEl.textContent = `${window.innerWidth}px × ${window.innerHeight}px`;
        
        const rect = mapContainer.getBoundingClientRect();
        containerSizeEl.textContent = `${Math.round(rect.width)}px × ${Math.round(rect.height)}px`;
        
        // Calculate scale based on a reference width of 1200px
        const referenceWidth = 1200;
        scale = Math.min(rect.width / referenceWidth, 1.0); // Cap at 1.0 for consistency
        scaleFactorEl.textContent = scale.toFixed(3);
        
        // Apply scale to map layers and event markers
        mapLayers.style.transform = `scale(${scale})`;
        eventMarkers.style.transform = `scale(${scale})`;
        
        // Update existing markers size to account for scale
        markers.forEach(marker => {
          marker.style.width = `${20 / scale}px`;
          marker.style.height = `${20 / scale}px`;
          marker.style.borderWidth = `${3 / scale}px`;
        });
      }
      
      // Track click on map to add marker at exact position
      mapContainer.addEventListener('click', function(e) {
        if (e.target === mapContainer || e.target === mapLayers) {
          const rect = mapContainer.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          // Calculate percentage coordinates adjusted for scale
          const xPercent = ((x / scale) / rect.width) * 100;
          const yPercent = ((y / scale) / rect.height) * 100;
          
          addMarker(xPercent, yPercent);
        }
      });
      
      // Create a new marker at specified position
      function addMarker(x, y) {
        const marker = document.createElement('div');
        marker.className = 'event-marker';
        
        marker.style.left = `${x}%`;
        marker.style.top = `${y}%`;
        
        // Size adjusted for scale
        marker.style.width = `${20 / scale}px`;
        marker.style.height = `${20 / scale}px`;
        marker.style.borderWidth = `${3 / scale}px`;
        
        // Random color
        const colors = ['#FF3333', '#33FF57', '#3357FF', '#FF33F5', '#33FFF5'];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        marker.style.backgroundColor = randomColor;
        
        marker.dataset.x = x.toFixed(2);
        marker.dataset.y = y.toFixed(2);
        
        // Add tooltip behavior - show coordinates on hover
        marker.title = `Marker at ${x.toFixed(1)}%, ${y.toFixed(1)}%`;
        
        // Add to DOM
        eventMarkers.appendChild(marker);
        markers.push(marker);
        
        // Update count and last position
        markerCountEl.textContent = markers.length;
        lastMarkerPositionEl.textContent = `${x.toFixed(1)}%, ${y.toFixed(1)}%`;
      }
      
      // Create a new marker at random position
      function addRandomMarker() {
        // Random position - percent based
        const x = Math.floor(Math.random() * 100);
        const y = Math.floor(Math.random() * 100);
        
        addMarker(x, y);
      }
      
      // Clear all markers
      function clearMarkers() {
        markers.forEach(marker => marker.remove());
        markers = [];
        markerCountEl.textContent = "0";
        lastMarkerPositionEl.textContent = "None";
      }
      
      // Load a test PDF
      function loadTestPdf() {
        // Replace image with a test PDF in an iframe
        const mapLayer = document.querySelector('.map-layer');
        mapLayer.innerHTML = `
          <iframe 
            src="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf#toolbar=0&navpanes=0&scrollbar=0&view=FitH" 
            style="width: 100%; height: 100%; border: none;"
          ></iframe>
        `;
      }
      
      // Load a test image
      function loadTestImage() {
        // Replace with placeholder image
        const mapLayer = document.querySelector('.map-layer');
        mapLayer.innerHTML = `
          <img src="https://via.placeholder.com/1200x900" alt="Test Map" id="mapImage">
        `;
      }
      
      // Reset scale to 1.0
      function resetScale() {
        scale = 1.0;
        scaleFactorEl.textContent = "1.0";
        mapLayers.style.transform = `scale(1)`;
        eventMarkers.style.transform = `scale(1)`;
        
        // Update markers for the new scale
        markers.forEach(marker => {
          marker.style.width = `${20 / scale}px`;
          marker.style.height = `${20 / scale}px`;
          marker.style.borderWidth = `${3 / scale}px`;
        });
      }
      
      // Toggle full width container
      function toggleFullWidth() {
        const container = document.querySelector('.container');
        if (isFullWidth) {
          container.style.maxWidth = '1200px';
          toggleFullWidthButton.textContent = 'Enable Full Width';
        } else {
          container.style.maxWidth = '100%';
          toggleFullWidthButton.textContent = 'Disable Full Width';
        }
        isFullWidth = !isFullWidth;
        
        // Update size info after layout change
        setTimeout(updateSizeInfo, 100);
      }
      
      // Event listeners
      addMarkerButton.addEventListener('click', addRandomMarker);
      clearMarkersButton.addEventListener('click', clearMarkers);
      testPdfButton.addEventListener('click', loadTestPdf);
      testImageButton.addEventListener('click', loadTestImage);
      resetScaleButton.addEventListener('click', resetScale);
      toggleFullWidthButton.addEventListener('click', toggleFullWidth);
      
      // Handle window resize
      window.addEventListener('resize', updateSizeInfo);
      
      // Initial setup
      updateSizeInfo();
      
      // Add some initial markers for testing
      for (let i = 0; i < 5; i++) {
        addRandomMarker();
      }
    });
  </script>
</body>
</html> 